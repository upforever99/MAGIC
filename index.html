<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>MAGIC</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* 原样式不变，仅新增 fullscreen-btn */
        .fullscreen-btn {
            background: none;
            border: none;
            cursor: pointer;
            margin-left: 10px;
        }
        .fullscreen-btn svg {
            width: 24px;
            height: 24px;
            fill: white;
            transition: transform .2s;
        }
        .fullscreen-btn:hover svg {
            transform: scale(1.15);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- 其余原样式 -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #e6f7ff 0%, #f0f8ff 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #2c3e50;
        }
        .app-container {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 40px;
            max-width: 900px;
            width: 100%;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .title {
            font-size: 2.5em;
            color: #2c3e50;
            font-weight: 300;
            letter-spacing: 2px;
        }
        .video-container {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .video-player {
            width: 100%;
            display: block;
        }
        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .video-container:hover .video-controls {
            opacity: 1;
        }
        .play-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .play-btn:hover {
            background: white;
            transform: scale(1.1);
        }
        .play-btn svg {
            width: 20px;
            height: 20px;
            fill: #2c3e50;
        }
        .progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }
        .progress {
            height: 100%;
            background: #3498db;
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s ease;
        }
        .time-display {
            color: white;
            font-size: 14px;
            font-weight: 300;
        }
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }
        .volume-level {
            height: 100%;
            background: #3498db;
            border-radius: 2px;
            width: 70%;
        }

        /* 新增观看次数样式 */
        .watch-count {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
            font-size: 1.1em;
            color: #2c3e50;
        }

        .count-update {
            animation: pulse 1s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); color: #3498db; }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
<div id="app">
    <div class="app-container">
        <div class="header">
            <h1 class="title">MAGIC</h1>
        </div>

        <div class="video-container" ref="videoBox">
            <video
                    ref="videoPlayer"
                    class="video-player"
                    :src="videoSrc"
                    @loadedmetadata="onVideoLoaded"
                    @timeupdate="updateProgress"
                    @ended="onVideoEnded"
                    autoplay
                    muted
            >
                您的浏览器不支持视频播放
            </video>

            <div class="video-controls">
                <button class="play-btn" @click="togglePlay">
                    <svg v-if="!isPlaying" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    <svg v-else viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                </button>

                <div class="progress-bar" @click="seekTo">
                    <div class="progress" :style="{ width: progressPercent + '%' }"></div>
                </div>

                <div class="time-display">{{ currentTime }} / {{ duration }}</div>

                <div class="volume-control">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                    </svg>
                    <div class="volume-slider" @click="setVolume">
                        <div class="volume-level" :style="{ width: volume + '%' }"></div>
                    </div>
                </div>

                <!-- 全屏按钮 -->
                <button class="fullscreen-btn" @click="toggleFullscreen" title="全屏 / 退出">
                    <i class="fa-solid fa-expand"></i>
                </button>
            </div>
        </div>

        <!-- 观看次数显示区域 -->
        <div class="watch-count" :class="{ 'count-update': countUpdated }">
            <i class="fa-solid fa-eye"></i> 已观看次数: {{ watchCount }}
        </div>
    </div>
</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                videoSrc: '程艾影.mp4',
                isPlaying: false,
                currentTime: '00:00',
                duration: '00:00',
                progressPercent: 0,
                volume: 70,
                watchCount: 0,       // 观看次数
                countUpdated: false  // 用于动画效果
            };
        },
        methods: {
            togglePlay() {
                const v = this.$refs.videoPlayer;
                this.isPlaying ? v.pause() : v.play();
                this.isPlaying = !this.isPlaying;
            },
            onVideoLoaded() {
                const v = this.$refs.videoPlayer;
                this.duration = this.formatTime(v.duration);
                v.volume = this.volume / 100;
            },
            updateProgress() {
                const v = this.$refs.videoPlayer;
                if (!v.duration) return;
                this.progressPercent = (v.currentTime / v.duration) * 100;
                this.currentTime = this.formatTime(v.currentTime);
            },
            seekTo(e) {
                const v = this.$refs.videoPlayer;
                const rect = e.currentTarget.getBoundingClientRect();
                v.currentTime = ((e.clientX - rect.left) / rect.width) * v.duration;
            },
            setVolume(e) {
                const rect = e.currentTarget.getBoundingClientRect();
                this.volume = Math.max(0, Math.min(100, ((e.clientX - rect.left) / rect.width) * 100));
                this.$refs.videoPlayer.volume = this.volume / 100;
            },
            onVideoEnded() {
                this.isPlaying = false;
                this.progressPercent = 0;
                this.currentTime = '00:00';

                // 增加观看次数
                this.watchCount += 1;
                this.countUpdated = true;

                // 保存到本地存储
                localStorage.setItem('magicVideoWatchCount', this.watchCount);

                // 移除动画类
                setTimeout(() => {
                    this.countUpdated = false;
                }, 1000);
            },
            formatTime(sec) {
                if (isNaN(sec)) return '00:00';
                const m = Math.floor(sec / 60).toString().padStart(2, '0');
                const s = Math.floor(sec % 60).toString().padStart(2, '0');
                return `${m}:${s}`;
            },
            toggleFullscreen() {
                const box = this.$refs.videoBox;
                if (!document.fullscreenElement) {
                    box.requestFullscreen?.() ||
                    box.webkitRequestFullscreen?.() ||
                    box.msRequestFullscreen?.();
                } else {
                    document.exitFullscreen?.() ||
                    document.webkitExitFullscreen?.() ||
                    document.msExitFullscreen?.();
                }
            }
        },
        mounted() {
            // 从本地存储读取观看次数
            const savedCount = localStorage.getItem('magicVideoWatchCount');
            if (savedCount) {
                this.watchCount = parseInt(savedCount, 10);
            }

            // 键盘 F 键快速全屏
            document.addEventListener('keydown', (e) => {
                if (e.key.toLowerCase() === 'f') this.toggleFullscreen();
            });
        }
    }).mount('#app');
</script>
</body>
</html>
