<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAGIC</title>

  <!-- Vue 3 CDN（如仍超时，可改本地 ./vue.global.prod.js） -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- FontAwesome 图标 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    /* ---------- 基础样式 ---------- */
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Segoe UI','Helvetica Neue',Arial,sans-serif;
      background:linear-gradient(135deg,#e6f7ff 0%,#f0f8ff 100%);
      min-height:100vh;display:flex;justify-content:center;align-items:center;
      padding:20px;color:#2c3e50;
    }
    .app-container{
      background:rgba(255,255,255,.85);backdrop-filter:blur(12px);
      border-radius:20px;box-shadow:0 8px 32px rgba(31,38,135,.05);
      border:1px solid rgba(255,255,255,.5);padding:40px;max-width:900px;width:100%;
    }
    .header{text-align:center;margin-bottom:30px}
    .title{font-size:2.5em;font-weight:300;letter-spacing:2px}

    /* ---------- 视频区域 ---------- */
    .video-container{position:relative;background:#000;border-radius:15px;overflow:hidden;margin-bottom:30px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
    .video-player{width:100%;display:block}
    .video-controls{
      position:absolute;bottom:0;left:0;right:0;
      background:linear-gradient(to top,rgba(0,0,0,.7),transparent);
      padding:15px 20px;display:flex;align-items:center;gap:12px;opacity:0;transition:opacity .3s;
    }
    .video-container:hover .video-controls{opacity:1}

    /* ---------- 控制按钮 ---------- */
    .play-btn,.mute-btn{
      background:rgba(255,255,255,.9);border:none;border-radius:50%;width:44px;height:44px;
      cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s;
    }
    .play-btn:hover,.mute-btn:hover{background:#fff;transform:scale(1.1)}
    .play-btn svg{width:18px;height:18px;fill:#2c3e50}
    .mute-btn i{font-size:18px;color:#2c3e50}

    /* ---------- 进度条 ---------- */
    .progress-bar{flex:1;height:6px;background:rgba(255,255,255,.3);border-radius:3px;cursor:pointer;position:relative}
    .progress{height:100%;background:#3498db;border-radius:3px;width:0%;transition:width .1s}
    .time-display{color:#fff;font-size:14px;font-weight:300}

    /* ---------- 音量条 ---------- */
    .volume-control{display:flex;align-items:center;gap:8px}
    .volume-slider{width:80px;height:4px;background:rgba(255,255,255,.3);border-radius:2px;cursor:pointer;position:relative}
    .volume-level{height:100%;background:#3498db;border-radius:2px;width:70%}

    /* ---------- 全屏按钮 ---------- */
    .fullscreen-btn{background:none;border:none;cursor:pointer;margin-left:6px}
    .fullscreen-btn svg{width:22px;height:22px;fill:#fff;transition:transform .2s}
    .fullscreen-btn:hover svg{transform:scale(1.15)}

    /* ---------- 观看次数 ---------- */
    .watch-count{text-align:center;margin-top:20px;padding:15px;background:rgba(52,152,219,.1);border-radius:10px;font-size:1.1em}
    .count-update{animation:pulse 1s ease-in-out}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05);color:#3498db}100%{transform:scale(1)}}
  </style>
</head>

<body>
  <div id="app">
    <div class="app-container">
      <div class="header"><h1 class="title">MAGIC</h1></div>

      <div class="video-container" ref="videoBox">
        <video ref="videoPlayer" class="video-player" :src="videoSrc" muted
               @loadedmetadata="onVideoLoaded" @timeupdate="updateProgress" @ended="onVideoEnded" autoplay>
          您的浏览器不支持视频播放
        </video>

        <div class="video-controls">
          <!-- 播放 / 暂停 -->
          <button class="play-btn" @click="togglePlay">
            <svg v-if="!isPlaying" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            <svg v-else viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
          </button>

          <!-- 进度条 -->
          <div class="progress-bar" @click="seekTo">
            <div class="progress" :style="{ width: progressPercent + '%' }"></div>
          </div>

          <!-- 时间 -->
          <div class="time-display">{{ currentTime }} / {{ duration }}</div>

          <!-- 静音 / 开声 -->
          <button class="mute-btn" @click="toggleMute" title="开/关声音">
            <i class="fa-solid" :class="isMuted ? 'fa-volume-xmark' : 'fa-volume-high'"></i>
          </button>

          <!-- 音量条 -->
          <div class="volume-control">
            <div class="volume-slider" @click="setVolume">
              <div class="volume-level" :style="{ width: volume + '%' }"></div>
            </div>
          </div>

          <!-- 全屏 -->
          <button class="fullscreen-btn" @click="toggleFullscreen" title="全屏">
            <i class="fa-solid fa-expand"></i>
          </button>
        </div>
      </div>

      <!-- 观看次数 -->
      <div class="watch-count" :class="{ 'count-update': countUpdated }">
        <i class="fa-solid fa-eye"></i> 已观看次数: {{ watchCount }}
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          videoSrc: '程艾影.mp4',
          isPlaying: false,
          currentTime: '00:00',
          duration: '00:00',
          progressPercent: 0,
          volume: 70,   // 默认音量
          isMuted: true, // 必须静音才能自动播放
          watchCount: 0,
          countUpdated: false
        };
      },
      methods: {
        togglePlay() {
          const v = this.$refs.videoPlayer;
          this.isPlaying ? v.pause() : v.play();
          this.isPlaying = !this.isPlaying;
        },
        onVideoLoaded() {
          const v = this.$refs.videoPlayer;
          this.duration = this.formatTime(v.duration);
          v.volume = this.volume / 100;
          v.muted = this.isMuted;
        },
        updateProgress() {
          const v = this.$refs.videoPlayer;
          if (!v.duration) return;
          this.progressPercent = (v.currentTime / v.duration) * 100;
          this.currentTime = this.formatTime(v.currentTime);
        },
        seekTo(e) {
          const v = this.$refs.videoPlayer;
          const rect = e.currentTarget.getBoundingClientRect();
          v.currentTime = ((e.clientX - rect.left) / rect.width) * v.duration;
        },
        setVolume(e) {
          const rect = e.currentTarget.getBoundingClientRect();
          this.volume = Math.max(0, Math.min(100, ((e.clientX - rect.left) / rect.width) * 100));
          const v = this.$refs.videoPlayer;
          v.volume = this.volume / 100;
          if (this.isMuted) {          // 用户主动调音量 → 帮他开声
            this.isMuted = false;
            v.muted = false;
          }
        },
        toggleMute() {
          const v = this.$refs.videoPlayer;
          this.isMuted = !this.isMuted;
          v.muted = this.isMuted;
          if (!this.isMuted) v.volume = this.volume / 100;
        },
        onVideoEnded() {
          this.isPlaying = false;
          this.progressPercent = 0;
          this.currentTime = '00:00';
          this.watchCount += 1;
          this.countUpdated = true;
          localStorage.setItem('magicVideoWatchCount', this.watchCount);
          setTimeout(() => (this.countUpdated = false), 1000);
        },
        formatTime(sec) {
          if (isNaN(sec)) return '00:00';
          const m = Math.floor(sec / 60).toString().padStart(2, '0');
          const s = Math.floor(sec % 60).toString().padStart(2, '0');
          return `${m}:${s}`;
        },
        toggleFullscreen() {
          const box = this.$refs.videoBox;
          if (!document.fullscreenElement) {
            box.requestFullscreen?.() || box.webkitRequestFullscreen?.() || box.msRequestFullscreen?.();
          } else {
            document.exitFullscreen?.() || document.webkitExitFullscreen?.() || document.msExitFullscreen?.();
          }
        }
      },
      mounted() {
        const saved = localStorage.getItem('magicVideoWatchCount');
        if (saved) this.watchCount = parseInt(saved, 10);
        document.addEventListener('keydown', (e) => {
          if (e.key.toLowerCase() === 'f') this.toggleFullscreen();
        });
      }
    }).mount('#app');
  </script>
</body>
</html>
